<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">

	<!-- insert, delete, update는 무조건 resultType="int"이므로 프로그래머가 써주지 않아도 이미 resultType="int"가 
		있는 것으로 본다.! -->

	<select id="best" resultType="productVO">
		select *
		from product
		where product_views >= 100
		limit 5
	</select>

	<select id="userBest" resultType="ProductVO" parameterType="String">
		select * from product 
		where category = (select category from 
		(select category , count(*) as category_count
		from recently_viewed rv, product p
		where rv.member_id = #{memberId} and rv.product_id = p.product_id
		group by category) as result
		order by category_count desc
		limit 1)
		limit 5
	</select>
	
	<select id="wekaBest" resultType="productVO" parameterType="String">
		select *
		from product
		where category = #{category}
		limit 5
	</select>
	
	<!-- <select id="all" resultType="productVO">
		select *
		from product
	</select>

	<select id="search" resultType="productVO" parameterType="String">
		select *
		from product
		where product_name like concat('%', #{search}, '%')
	</select> -->
	
	<select id="searchAll" resultType="productVO"  parameterType="Map">
		select * from (
		select ROW_NUMBER() over(order by product_id desc) as product_no, p.*
		from product p
		where product_name like concat('%', #{search}, '%')) product2
		where product2.product_no between #{start} and #{end}
	</select>

	<select id="categoryAll" resultType="productVO"  parameterType="Map">
		select * from (
		select ROW_NUMBER() over(order by product_id desc) as product_no, p.*
		from product p
		where category = #{category}) product2
		where product2.product_no between #{start} and #{end}
	</select>
	
	<select id="countSearch" resultType="Integer" parameterType="String">
		select count(*) from product
		where product_name like concat('%', #{search}, '%')
	</select>

	<select id="countCategory" resultType="Integer" parameterType="String">
		select count(*) from product
		where category = #{category}
	</select>

	<update id="viewsCount" parameterType="Integer">
		update product 
		set product_views = product_views + 1
		where product_id = #{productId}
	</update>

	<!-- vo와 db table의 같을 때는 자동으로
	컬럼명과 동일한 vo의 변수에 자동으로 넣어줌.
	
	vo와 db table이 다를 때는 수동으로
	어떤 컬럼명에서 꺼내서 vo의 변수에 넣어줄지
	mapping을 해주어야 함. -->
	<!-- 
	<resultMap type="memberVO" id="map1">
		<result />
	</resultMap> -->
</mapper>











